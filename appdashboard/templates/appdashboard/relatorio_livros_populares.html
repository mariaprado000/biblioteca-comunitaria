{% extends 'appdashboard/base.html' %}

{% block title %}Livros Mais Populares - Biblioteca Comunitária{% endblock %}

{% block content %}
<div class='row mb-3'>
    <div class='col'>
        <h2><i class='fas fa-chart-bar'></i> Livros Mais Populares</h2>
    </div>
    <div class='col text-right'>
        <a href='{% url 'home' %}' class='btn btn-secondary'>
            <i class='fas fa-arrow-left'></i> Voltar
        </a>
    </div>
</div>

<div class='card'>
    <div class='card-body'>
        <p class='text-muted'>Ranking dos livros mais emprestados da biblioteca</p>
        
        <div class='table-responsive'>
            <table class='table table-striped table-hover'>
                <thead class='thead-dark'>
                    <tr>
                        <th width='50'>#</th>
                        <th>Título</th>
                        <th>Autor</th>
                        <th>Categoria</th>
                        <th>Total de Empréstimos</th>
                        <th>Disponível</th>
                    </tr>
                </thead>
                <tbody>
                    {% for livro in livros %}
                    <tr>
                        <td>
                            {% if forloop.counter <= 3 %}
                                <span class='badge badge-warning'><i class='fas fa-trophy'></i> {{ forloop.counter }}</span>
                            {% else %}
                                {{ forloop.counter }}
                            {% endif %}
                        </td>
                        <td><strong>{{ livro.titulo }}</strong></td>
                        <td>{{ livro.autor }}</td>
                        <td>{{ livro.categoria|default:'-' }}</td>
                        <td>
                            <span class='badge badge-primary badge-pill'>{{ livro.num_emprestimos }}</span>
                        </td>
                        <td>
                            {% if livro.disponivel %}
                                <span class='badge badge-success'>Sim</span>
                            {% else %}
                                <span class='badge badge-danger'>Não</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan='6' class='text-center'>Nenhum livro foi emprestado ainda.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if livros %}
        <div class='mt-4'>
            <h5>Estatísticas Gerais:</h5>
            <div class='row'>
                <div class='col-md-4'>
                    <div class='card bg-primary text-white'>
                        <div class='card-body'>
                            <h6 class='card-title'>Total de Livros Emprestados</h6>
                            <h3>{{ livros|length }}</h3>
                        </div>
                    </div>
                </div>
                <div class='col-md-4'>
                    <div class='card bg-success text-white'>
                        <div class='card-body'>
                            <h6 class='card-title'>Total de Empréstimos</h6>
                            <h3>{{ total_emprestimos }}</h3>
                        </div>
                    </div>
                </div>
                <div class='col-md-4'>
                    <div class='card bg-info text-white'>
                        <div class='card-body'>
                            <h6 class='card-title'>Livro Mais Popular</h6>
                            <p class='mb-0'><strong>{{ livros.0.titulo }}</strong></p>
                            <small>{{ livros.0.num_emprestimos }} empréstimos</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
